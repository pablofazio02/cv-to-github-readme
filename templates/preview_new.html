<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preview y Edici√≥n - README Generator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f6f8fa;
        color: #24292e;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      h1 {
        color: #0366d6;
        margin-bottom: 10px;
        text-align: center;
      }
      .subtitle {
        color: #586069;
        margin-bottom: 30px;
        font-size: 16px;
        text-align: center;
      }
      .status {
        background: #e6ffed;
        border: 1px solid #34d058;
        color: #22863a;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 20px;
        text-align: center;
      }
      .form-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        overflow: hidden;
      }
      .preview-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .section-header {
        background: #0366d6;
        color: white;
        padding: 15px 20px;
        font-weight: 600;
        font-size: 16px;
      }
      .section-content {
        padding: 20px;
      }
      .section {
        margin-bottom: 25px;
        border: 1px solid #e1e4e8;
        border-radius: 8px;
        padding: 20px;
        background: #fafbfc;
      }
      .section h3 {
        margin: 0 0 15px 0;
        color: #24292e;
        font-size: 18px;
        display: flex;
        align-items: center;
      }
      .section h3::before {
        margin-right: 8px;
        font-size: 20px;
      }
      .personal-info h3::before {
        content: "üë§";
      }
      .social-info h3::before {
        content: "üåê";
      }
      .skills-info h3::before {
        content: "üõ†";
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #24292e;
      }
      input[type="text"],
      input[type="email"],
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5da;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
        transition: border-color 0.15s ease-in-out;
      }
      input[type="text"]:focus,
      input[type="email"]:focus,
      textarea:focus {
        outline: none;
        border-color: #0366d6;
        box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
      }
      textarea {
        resize: vertical;
        min-height: 100px;
        font-family: inherit;
      }
      .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }
      .form-row > div {
        flex: 1;
      }
      .help-text {
        font-size: 12px;
        color: #586069;
        margin-top: 5px;
      }
      .buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e1e4e8;
      }
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.15s ease;
      }
      .btn-primary {
        background: #0366d6;
        color: white;
      }
      .btn-primary:hover {
        background: #0256cc;
      }
      .btn-secondary {
        background: #f6f8fa;
        color: #24292e;
        border: 1px solid #d1d5da;
      }
      .btn-secondary:hover {
        background: #f3f4f6;
      }
      .empty-field {
        color: #d73a49;
        font-style: italic;
      }

      /* Preview styles */
      .preview-content {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica,
          Arial, sans-serif;
        line-height: 1.6;
      }
      .preview-content h1 {
        color: #24292e;
        border-bottom: 1px solid #e1e4e8;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      .preview-content h2 {
        color: #24292e;
        margin-top: 30px;
        margin-bottom: 15px;
      }
      .preview-content p {
        margin-bottom: 16px;
      }
      .preview-content ul {
        padding-left: 20px;
      }
      .preview-content li {
        margin-bottom: 8px;
      }
      .preview-content details {
        margin: 20px 0;
      }
      .preview-content summary {
        cursor: pointer;
        font-weight: 600;
      }
      .preview-icons {
        text-align: center;
        margin: 20px 0;
      }
      .preview-icons img {
        margin: 0 10px;
        vertical-align: middle;
      }
      .preview-stats {
        text-align: center;
        margin: 20px 0;
      }
      .preview-stats img {
        margin: 10px;
        border-radius: 6px;
      }

      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìù Preview y Edici√≥n</h1>
      <p class="subtitle">
        Edita la informaci√≥n extra√≠da y ve la preview del README abajo.
      </p>

      <div class="status">
        ‚úÖ <strong>PDF procesado correctamente:</strong> {{ filename }}
      </div>

      <!-- Secci√≥n del Formulario -->
      <div class="form-section">
        <div class="section-header">‚úèÔ∏è Editar Informaci√≥n</div>
        <div class="section-content">
          <form method="POST" action="/generate" id="edit-form">
            <!-- Informaci√≥n Personal -->
            <div class="section personal-info">
              <h3>Informaci√≥n Personal</h3>
              <div class="form-row">
                <div>
                  <label for="first_name">Nombre:</label>
                  <input
                    type="text"
                    id="first_name"
                    name="first_name"
                    value="{{ data.first_name }}"
                    placeholder="Juan"
                  />
                </div>
                <div>
                  <label for="last_name">Apellidos:</label>
                  <input
                    type="text"
                    id="last_name"
                    name="last_name"
                    value="{{ data.last_name }}"
                    placeholder="P√©rez Garc√≠a"
                  />
                </div>
              </div>
            </div>

            <!-- Informaci√≥n Social -->
            <div class="section social-info">
              <h3>Redes Sociales y Contacto</h3>
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                value="{{ data.email }}"
                placeholder="tu.email@example.com"
              />

              <br />
              <label for="github">Github user:</label>
              <input
                type="text"
                id="github"
                name="github"
                value="{{ data.github }}"
                placeholder="tu-usuario-github"
              />

              <br />
              <label for="linkedin">LinkedIn user:</label>
              <input
                type="text"
                id="linkedin"
                name="linkedin"
                value="{{ data.linkedin }}"
                placeholder="tu-usuario-linkedin"
              />
            </div>

            <!-- Skills -->
            <div class="section skills-info">
              <h3>Habilidades y Tecnolog√≠as</h3>
              <label for="skills">Skills (separadas por comas):</label>
              <textarea
                id="skills"
                name="skills"
                placeholder="Python, JavaScript, React, SQL, Git, Docker"
              >
{% for skill in data.skills %}{{ skill }}{% if not loop.last %}, {% endif %}{% endfor %}</textarea
              >
              <div class="help-text">
                {% if data.skills %}{{ data.skills|length }} habilidades
                encontradas{% else %}<span class="empty-field"
                  >No se encontraron skills en el CV</span
                >{% endif %}
              </div>

              <div style="margin-top: 15px">
                <button
                  type="button"
                  id="add-skill"
                  class="btn btn-secondary"
                  style="font-size: 12px; padding: 8px 16px"
                >
                  ‚ûï Agregar Skill
                </button>
                <input
                  type="text"
                  id="new-skill"
                  placeholder="Nueva habilidad"
                  style="margin-left: 10px; width: 150px; padding: 8px"
                />
              </div>
            </div>

            <!-- Botones -->
            <div class="buttons">
              <button type="submit" class="btn btn-primary">
                üöÄ Generar README.md
              </button>
              <a href="/" class="btn btn-secondary"> ‚¨ÖÔ∏è Subir otro CV </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Secci√≥n de Preview -->
      <div class="preview-section">
        <div class="section-header">üëÄ Preview del README</div>
        <div class="section-content">
          <div class="preview-content" id="readme-preview">
            <!-- El contenido se generar√° din√°micamente con JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Funci√≥n para generar la preview del README
      function updatePreview() {
        const firstName = document.getElementById("first_name").value.trim();
        const lastName = document.getElementById("last_name").value.trim();
        const email = document.getElementById("email").value.trim();
        const github = document.getElementById("github").value.trim();
        const linkedin = document.getElementById("linkedin").value.trim();
        const skills = document.getElementById("skills").value.trim();

        const fullName = `${firstName} ${lastName}`.trim();
        const title = fullName || github || "Mi Perfil";

        let preview = `<h1>${title}</h1>\n`;

        // Secci√≥n de iconos sociales
        const socialIcons = [];
        if (email)
          socialIcons.push(
            `<a href="mailto:${email}"><img width="40px" src="https://img.icons8.com/color/48/000000/gmail--v1.png" alt="Email"></a>`
          );
        if (linkedin)
          socialIcons.push(
            `<a href="https://linkedin.com/in/${linkedin}"><img width="40px" src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn"></a>`
          );
        if (github)
          socialIcons.push(
            `<a href="https://github.com/${github}"><img width="40px" src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub"></a>`
          );

        if (socialIcons.length > 0) {
          preview += `<div class="preview-icons">${socialIcons.join(
            "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
          )}</div>`;
        }

        // Estad√≠sticas de GitHub
        if (github) {
          preview += `
                    <details open>
                        <summary><h2>üìä GitHub Stats</h2></summary>
                        <div class="preview-stats">
                            <img height="200" alt="${github}'s Github Stats" src="https://github-readme-stats.vercel.app/api/?username=${github}" />
                            <img height="200" alt="${github}'s Top Languages" src="https://github-readme-stats.vercel.app/api/top-langs/?username=${github}&langs_count=8&layout=compact&hide=Jupyter%20Notebook,Roff" />
                        </div>
                    </details>
                `;
        }

        // Secci√≥n de Skills
        preview += "<h2>üõ† Skills & Technologies</h2>";
        if (skills) {
          const skillList = skills
            .split(",")
            .map((skill) => skill.trim())
            .filter((skill) => skill);
          if (skillList.length > 0) {
            preview += "<ul>";
            skillList.forEach((skill) => {
              preview += `<li>${skill}</li>`;
            });
            preview += "</ul>";
          } else {
            preview += "<p><em>No se encontraron skills en el CV.</em></p>";
          }
        } else {
          preview += "<p><em>No se encontraron skills en el CV.</em></p>";
        }

        // Footer
        preview +=
          '<hr><p><em>Generado autom√°ticamente desde el CV PDF por <a href="https://github.com/pablofazio02/cv-to-github-readme">cv-to-github-readme</a></em></p>';

        document.getElementById("readme-preview").innerHTML = preview;
      }

      // Actualizar preview cuando cambien los campos
      document.querySelectorAll("input, textarea").forEach((element) => {
        element.addEventListener("input", updatePreview);
      });

      // Auto-resize textareas
      document.querySelectorAll("textarea").forEach((textarea) => {
        textarea.addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = this.scrollHeight + "px";
        });
        // Initial resize
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
      });

      // Agregar nueva skill
      document
        .getElementById("add-skill")
        .addEventListener("click", function () {
          const newSkill = document.getElementById("new-skill").value.trim();
          if (newSkill) {
            const skillsTextarea = document.getElementById("skills");
            const currentSkills = skillsTextarea.value.trim();

            if (currentSkills) {
              skillsTextarea.value = currentSkills + ", " + newSkill;
            } else {
              skillsTextarea.value = newSkill;
            }

            document.getElementById("new-skill").value = "";
            updatePreview();
          }
        });

      // Enter en el campo de nueva skill
      document
        .getElementById("new-skill")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            document.getElementById("add-skill").click();
          }
        });

      // Form validation
      document.querySelector("form").addEventListener("submit", function (e) {
        const firstName = document.getElementById("first_name").value.trim();
        const lastName = document.getElementById("last_name").value.trim();
        const github = document.getElementById("github").value.trim();

        if (!firstName && !lastName && !github) {
          e.preventDefault();
          alert(
            "Por favor, completa al menos el nombre o el usuario de GitHub."
          );
          return false;
        }
      });

      // Cargar preview inicial
      updatePreview();
    </script>
  </body>
</html>
